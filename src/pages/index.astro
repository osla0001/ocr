---
import Layout from "../layouts/Layout.astro";
import Letter from "../components/Letter.astro";
import Hero from "../components/Hero.astro";
import Blur from "../components/Blur.astro";
import IndexNote from "../components/IndexNote.astro";
---

<Layout title="osçar's Portfolio" meta="Forsiden til min portfolio hjemmeside">
  <Hero />
  <section class="additional-content">
    <section id="presentation">
      <div class="presentation-inner">
        <img src="/assets/logo.svg" alt="" class="small_logo" />
        <h2>osçar’s Portfolio</h2>
        <p>
          Denne side er et levende arkiv over mine værker, mine færdigheder og
          de æstetiske tanker, der former min tilgang til design. Her får du et
          indblik i både det digitale håndværk, jeg har skabt ved tastaturet, og
          de projekter, der tager form uden for skærmens lys. Du finder nyttig
          viden om min baggrund, mine erfaringer og mine kreative udfoldelser.
          Tag dig tid til at bevæge dig rundt på siden, udforske de små detaljer
          og lade de interaktive elementer føre dig på opdagelse i mit arbejde.
        </p>
        <img src="/assets/paper_holes.png" alt="" class="background_image" />
      </div>
    </section>
    <IndexNote />
    <Blur />
    <Letter />
  </section>

  <!-- Snap scroll -->
  <script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
      const zoomEl = document.querySelector(".zoom");
      let snapScrollActive = false;
      let firstScroll = true;
      let lastSnapTime = Date.now();

      function activateSnapScroll() {
        if (snapScrollActive) return;
        snapScrollActive = true;

        const sections = Array.from(document.querySelectorAll("section[id]"));
        let isSnapping = false;

        // Desktop: Wheel events
        window.addEventListener(
          "wheel",
          (e) => {
            const now = Date.now();
            if (isSnapping || now - lastSnapTime < 1500) {
              e.preventDefault();
              return;
            }
            handleScroll(e.deltaY > 0 ? "down" : "up", now);
            e.preventDefault();
          },
          { passive: false },
        );

        // Mobile: Touch events
        let startY = null;
        let startTime = null;

        window.addEventListener("touchstart", (e) => {
          startY = e.touches[0].clientY;
          startTime = Date.now();
        });

        window.addEventListener(
          "touchend",
          (e) => {
            if (!startY || !startTime) return;

            const endY = e.changedTouches[0].clientY;
            const endTime = Date.now();
            const deltaY = startY - endY;
            const deltaTime = endTime - startTime;

            // Kun hvis swipe er lang nok og hurtig nok
            if (Math.abs(deltaY) > 50 && deltaTime < 300) {
              const now = Date.now();
              if (isSnapping || now - lastSnapTime < 1500) {
                e.preventDefault();
                return;
              }
              handleScroll(deltaY > 0 ? "down" : "up", now);
            }

            startY = null;
            startTime = null;
          },
          { passive: false },
        );

        function handleScroll(direction, now) {
          isSnapping = true;
          lastSnapTime = now;

          // Første scroll efter zoom: tving til #presentation
          if (firstScroll) {
            firstScroll = false;
            const presentationSection = document.getElementById("presentation");
            if (presentationSection) {
              presentationSection.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
            setTimeout(() => {
              isSnapping = false;
            }, 900);
            return;
          }

          // Basic snap scroll: én sektion ad gangen
          let closestIdx = 0;
          let minDist = Math.abs(sections[0].getBoundingClientRect().top);

          sections.forEach((section, idx) => {
            const dist = Math.abs(section.getBoundingClientRect().top);
            if (dist < minDist) {
              minDist = dist;
              closestIdx = idx;
            }
          });

          let nextIdx = closestIdx;
          if (direction === "down" && closestIdx < sections.length - 1) {
            nextIdx = closestIdx + 1;
          } else if (direction === "up" && closestIdx > 0) {
            nextIdx = closestIdx - 1;
          }

          sections[nextIdx].scrollIntoView({
            behavior: "smooth",
            block: "start",
          });

          setTimeout(() => {
            isSnapping = false;
          }, 900);
        }
      }

      // Aktiver snap scroll når zoom-animationen er færdig
      zoomEl.addEventListener("transitionend", (event) => {
        if (
          event.propertyName === "width" ||
          event.propertyName === "height" ||
          event.propertyName === "transform"
        ) {
          activateSnapScroll();
        }
      });
    });
  </script>

  <style>
    html,
    body {
      height: 100%;
      overflow-x: hidden;
    }

    main {
      scroll-snap-type: y mandatory;
      overflow-y: scroll;
      height: 100vh;
    }

    section {
      scroll-snap-align: start;
      height: 100vh;
    }

    .additional-content {
      opacity: 1;
      pointer-events: none;
      transition: opacity 0.1s;
      display: block;
      visibility: hidden;
      max-width: 70ch;
      margin: 50px auto 50px auto;
      width: 100%;
    }

    h2 {
      font-family: roundhand-regular, sans-serif;
      font-size: 300%;
      font-weight: 300;
      margin-bottom: 20px;
      text-align: center;
      margin-bottom: 1px;
    }

    #presentation {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .presentation-inner {
      max-width: 70ch;
      margin: 0 auto;
      width: 100%;
      position: relative;
      z-index: 1;
      text-align: justify;
    }

    .background_image {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 115%;
      height: auto;
      z-index: -1;
      user-select: none;
      object-fit: fill;
      box-shadow: 10px 10px 5px 0px rgba(0, 0, 0, 0.24);
    }

    .small_logo {
      display: block;
      margin: 0 auto;
      width: 15%;
      height: auto;
    }

    #presentation p {
      text-align: justify;
      font-family: "Times New Roman", Times, serif;
      font-size: 100%;
    }

    @media (max-width: 768px) {
      #presentation {
        padding: 20px;
        height: auto;
        min-height: 100vh;
      }

      .background_image {
        width: 105%;
      }

      .presentation-inner {
        max-width: 90%;
        margin: 0 auto;
        padding: 20px;
      }

      .small_logo {
        width: 12%; /* Større logo på mobil */
        margin-bottom: 0px;
        display: none;
      }

      h2 {
        font-size: 160%; /* Større tekst på mobil */
      }

      #presentation p {
        font-size: 75%; /* Større tekst på mobil */
        line-height: 1.6;
      }
    }
  </style>
</Layout>
